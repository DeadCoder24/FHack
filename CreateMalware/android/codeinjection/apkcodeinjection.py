try:
    from src.libs import BS
    import sys, os
    from src.Colors import TextColor
    import subprocess as subproc
except Exception as error:
    raise SystemExit, '\033[31m' + '%s' % error + "\033[0m"

currentPath = os.getcwd()


def Decompile():
    print
    print TextColor.WARNING + "[+] Decompiling TARGET -- Please wait" + TextColor.WHITE

    command = ['apktool', '--version']
    # Check that apktool is install in system
    process = subproc.Popen(command, stdout=subproc.PIPE, stderr=subproc.PIPE)
    apktoolVersion, error = process.communicate()

    if "2." not in apktoolVersion:
        raise SystemExit, TextColor.RED + "[-] You do not have  << apktool >> please install it from setup.py" + \
                          TextColor.WHITE
    else:

        EndpointIp = raw_input(TextColor.CVIOLET + '~/Fhack/# Enter your RHOST(Your IP): ' + TextColor.WHITE)

        EndpointPORT = int(raw_input(TextColor.CVIOLET + "~/Fhack/# Enter your RPORT(Your PORT): " + TextColor.WHITE))

        if EndpointPORT > 65535:
            raise SystemExit, TextColor.RED + "We have not port bigger than 65535 ... !" + TextColor.WHITE

        apkPath = raw_input(TextColor.CVIOLET + "~/Fhack/# Enter apk(application) full path: " + TextColor.WHITE)

        # Decompiling application with apk tool
        print TextColor.WHITESMOKE + "[*] Please wait to complete this setp"
        command = ["apktool", "d", "-f", "-r", apkPath]
        process = subproc.Popen(command, stdout=subproc.PIPE, stderr=subproc.PIPE)
        result = process.communicate()[0]  # end decompiling

        if "error" in result:
            print TextColor.RED + "[-] APKTool have error on decompiling: %s" % result + TextColor.WHITE
        else:
            print TextColor.GREEN + "[+] APKTool Decompile was success"


def InjectCode():
    # print 'comming soon please wait'

    Decompile()  # first we decompile the target apk


if __name__ == "__main__":
    InjectCode()
