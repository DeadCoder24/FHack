try:
    from src.libs import BS
    import sys, os
    from src.Colors import TextColor
    import subprocess as subproc
    from time import sleep
except Exception as error:
    raise SystemExit, '\033[31m' + '%s' % error + "\033[0m"

decomOutPutPath = os.getcwd() + "/outputs/Malwares/"

define_ENDPOINTIP = ""
define_ENDPOINTPORT = ""


def Decompile():
    print
    print TextColor.WARNING + "[+] Decompiling TARGET -- Please wait" + TextColor.WHITE

    command = ['apktool', '--version']
    # Check that apktool is install in system
    process = subproc.Popen(command, stdout=subproc.PIPE, stderr=subproc.PIPE)
    apktoolVersion, error = process.communicate()

    if "2." not in apktoolVersion:
        raise SystemExit, TextColor.RED + "[-] You do not have  << apktool >> please install it from setup.py" + \
                          TextColor.WHITE
    else:

        define_ENDPOINTIP = raw_input(TextColor.CVIOLET + '~/Fhack/# Enter your RHOST(Your IP): ' + TextColor.WHITE)

        define_ENDPOINTPORT = int(
            raw_input(TextColor.CVIOLET + "~/Fhack/# Enter your RPORT(Your PORT): " + TextColor.WHITE))

        if define_ENDPOINTPORT > 65535:
            raise SystemExit, TextColor.RED + "We have not port bigger than 65535 ... !" + TextColor.WHITE

        apkPath = raw_input(TextColor.CVIOLET + "~/Fhack/# Enter apk(application) full path: " + TextColor.WHITE)

        print
        print TextColor.WARNING + "---------- Starting the process ----------"
        sleep(1)
        print TextColor.CYAN + "[+] Endpoint Ip set as: %s" % define_ENDPOINTIP + TextColor.WHITE
        sleep(.5)
        print TextColor.CYAN + "[+] Endpoint Port set as: %s" % define_ENDPOINTPORT + TextColor.WHITE
        sleep(.5)
        print TextColor.WHITESMOKE + "[*] Please wait to complete this step"

        # Decompiling application with apk tool
        outPutApkDirectory = (apkPath.split('/')[-1]).split('.')[0]
        command = ["apktool", "d", "-f", "-r", apkPath,
                   '-o', decomOutPutPath + "CreateMalware/Android/" + outPutApkDirectory]
        process = subproc.Popen(command, stdout=subproc.PIPE, stderr=subproc.PIPE)
        result = process.communicate()[0]  # end decompiling

        if "error" in result:
            raise SystemExit, TextColor.RED + "[-] APKTool have error on decompiling: %s" % result + TextColor.WHITE
            print
        else:
            print TextColor.GREEN + "[+] APKTool Decompile was success"
            return decomOutPutPath + "CreateMalware/Android/" + outPutApkDirectory


def ByteReadyHttpsCOMM():
    pass


def ByteReadyTCPCOMM():
    print TextColor.WHITESMOKE + "[+] Byting in tcp comms" + TextColor.WHITE


def InjectCode():
    print 'comming soon please wait'
    return

    global define_ENDPOINTPORT, define_ENDPOINTIP

    if not os.path.exists(decomOutPutPath):
        os.mkdir(decomOutPutPath)

    decompileDir = Decompile()  # first we decompile the target apk

    # now we must ready comms to connect apk to one of them
    try:
        if "https" in define_ENDPOINTIP:
            ByteReadyHttpsCOMM()
        else:
            ByteReadyTCPCOMM()
    except Exception as error:
        raise SystemExit, TextColor.RED + "%s" % error + TextColor.WHITE


if __name__ == "__main__":
    InjectCode()
